<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Friends - MotoMatch</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/friends-enhanced.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/friend-recommendations.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script>
    window.motosLikes = {{ motos_likes|tojson|safe }};
</script>
<script src="{{ url_for('static', filename='js/friends.js') }}" defer></script>
</head>
<body>
<div class="main-container">
    <a href="{{ url_for('main.dashboard') }}" class="back-dashboard-btn">
        <i class="fas fa-arrow-left"></i> Regresar al Dashboard
    </a>
    <h1 class="tituloFriends">Amigos</h1>
    
    <!-- Mensajes flash para recomendaciones de amigos -->
    {% with messages = get_flashed_messages(category_filter=['friend-recommendations']) %}
    {% if messages %}
    <div class="friend-recommendation-flash">
        {% for message in messages %}
        {{ message|safe }}
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

<div class="friends-section">
<div class="friends-column">
<div class="column-header">
<i class="fas fa-users"></i>
<h2>Amigos actuales</h2>
</div>
<ul id="amigos-list">
 {% for amigo in amigos %}
<li>
<button class="friend-name" data-username="{{ amigo }}">{{ amigo }}</button>
<form action="{{ url_for('main.eliminar_amigo') }}" method="POST" class="friend-action-form">
<input type="hidden" name="amigo" value="{{ amigo }}">
<button type="submit" class="remove-friend-btn"><i class="fas fa-user-minus"></i> Eliminar</button>
</form>
</li>
 {% endfor %}
</ul>
</div>
<div class="suggestions-column">
<div class="column-header">
<i class="fas fa-user-plus"></i>
<h2>Gente que quizá conozcas</h2>
</div>
<ul>
 {% for sugerencia in sugerencias %}
<li>
<span class="suggestion-name">{{ sugerencia }}</span>
<form action="{{ url_for('main.agregar_amigo') }}" method="POST" class="friend-action-form">
<input type="hidden" name="amigo" value="{{ sugerencia }}">
<button type="submit" class="add-friend-btn"><i class="fas fa-plus"></i> Agregar</button>
</form>
</li>
 {% endfor %}
</ul>
</div>
</div>
</div>
<!-- Pop-up -->
<div id="popup" class="popup hidden">
<div class="popup-content">
<span id="popup-close" class="popup-close">&times;</span>
<h3>Motos que le gustaron a <span id="popup-username"></span></h3>
<ul id="popup-motos-list"></ul>
</div>
</div>
<footer>
<p>&copy; 2025 MotoMatch. Todos los derechos reservados. | <a href="/" class="link">Inicio</a></p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Función para verificar y corregir enlaces problemáticos
    function fixBrokenLinks() {
        document.querySelectorAll('a').forEach(function(link) {
            if (link.href.includes('undefined') || link.href.includes('None')) {
                // Intentar corregir el enlace según su texto o contenido
                const linkText = link.textContent.trim().toLowerCase();
                
                if (linkText.includes('dashboard') || linkText.includes('regresar')) {
                    link.href = '/dashboard';
                } else if (linkText.includes('inicio')) {
                    link.href = '/';
                }
            }
        });
    }
    
    // Corregir los formularios con problemas
    function fixBrokenForms() {
        document.querySelectorAll('form').forEach(function(form) {
            if (form.action.includes('undefined') || form.action.includes('None')) {
                // Intentar corregir la acción del formulario según los elementos
                if (form.querySelector('.add-friend-btn')) {
                    form.action = '/agregar_amigo';
                } else if (form.querySelector('.remove-friend-btn')) {
                    form.action = '/eliminar_amigo';
                }
            }
        });
    }
    
    // Ejecutar correcciones
    fixBrokenLinks();
    fixBrokenForms();
});
</script>
</body>
</html>